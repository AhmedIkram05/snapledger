<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered personal finance tracker - Smart expense tracking with machine learning insights">
    <meta name="theme-color" content="#4F46E5">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
    
    <title>SnapLedger - AI Finance Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- App Container -->
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>SnapLedger</h1>
                <button id="installBtn" class="install-btn" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg> Install App
                </button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                Dashboard
            </button>
            <button class="nav-tab" data-tab="expenses">
                Expenses
            </button>
            <button class="nav-tab" data-tab="insights">
                AI Insights
            </button>
            <button class="nav-tab" data-tab="settings">
                Settings
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <section id="dashboard-tab" class="tab-content active">
                <div class="dashboard-grid">
                    <!-- Summary Cards -->
                    <div class="card summary-card">
                        <h3>This Month</h3>
                        <div class="amount" id="monthlyTotal">$0.00</div>
                        <div class="card-footer">
                            <span id="monthlyChange" class="change-indicator">+0%</span>
                            <span class="label">vs last month</span>
                        </div>
                    </div>

                    <div class="card summary-card">
                        <h3>Budget Left</h3>
                        <div class="amount" id="budgetLeft">$0.00</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="budgetProgress"></div>
                        </div>
                    </div>

                    <div class="card summary-card">
                        <h3>Avg. Daily</h3>
                        <div class="amount" id="dailyAverage">$0.00</div>
                        <div class="card-footer">
                            <span class="label">Based on last 30 days</span>
                        </div>
                    </div>

                    <!-- Spending Chart -->
                    <div class="card chart-card">
                        <h3>Spending Trend</h3>
                        <canvas id="spendingChart"></canvas>
                    </div>

                    <!-- Category Breakdown -->
                    <div class="card chart-card">
                        <h3>Category Breakdown</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>

                    <!-- Recent Transactions -->
                    <div class="card">
                        <h3>Recent Transactions</h3>
                        <div id="recentTransactions" class="transaction-list">
                            <p class="empty-state">No transactions yet. Add your first expense!</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Expenses Tab -->
            <section id="expenses-tab" class="tab-content">
                <div class="expenses-container">
                    <!-- Add Expense Form -->
                    <div class="card">
                        <h3>Add New Expense</h3>
                        <form id="expenseForm" class="expense-form">
                            <div class="form-group">
                                <label for="expenseDescription">Description</label>
                                <input type="text" id="expenseDescription" placeholder="e.g., Coffee at Starbucks" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseAmount">Amount ($)</label>
                                    <input type="number" id="expenseAmount" step="0.01" min="0" placeholder="0.00" required>
                                </div>

                                <div class="form-group">
                                    <label for="expenseDate">Date</label>
                                    <input type="date" id="expenseDate" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="expenseCategory">Category</label>
                                <select id="expenseCategory" required>
                                    <option value="">Let AI suggest...</option>
                                    <option value="food">Food & Dining</option>
                                    <option value="transport">Transportation</option>
                                    <option value="shopping">Shopping</option>
                                    <option value="bills">Bills & Utilities</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="health">Health & Fitness</option>
                                    <option value="education">Education</option>
                                    <option value="other">Other</option>
                                </select>
                                <div id="aiSuggestion" class="ai-suggestion" style="display: none;">
                                    AI suggests: <span id="suggestedCategory"></span>
                                    <button type="button" id="acceptSuggestion" class="btn-link">Accept</button>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">Add Expense</button>
                        </form>
                    </div>

                    <!-- Filters -->
                    <div class="card">
                        <h3>Filter & Search</h3>
                        <div class="filter-controls">
                            <input type="text" id="searchExpenses" placeholder="Search expenses..." class="search-input">
                            
                            <select id="filterCategory" class="filter-select">
                                <option value="">All Categories</option>
                                <option value="food">Food & Dining</option>
                                <option value="transport">Transportation</option>
                                <option value="shopping">Shopping</option>
                                <option value="bills">Bills & Utilities</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="health">Health & Fitness</option>
                                <option value="education">Education</option>
                                <option value="other">Other</option>
                            </select>

                            <select id="filterPeriod" class="filter-select">
                                <option value="all">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                    </div>

                    <!-- Expense List -->
                    <div class="card">
                        <h3>All Expenses</h3>
                        <div id="expensesList" class="transaction-list">
                            <p class="empty-state">No expenses to show.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI Insights Tab -->
            <section id="insights-tab" class="tab-content">
                <div class="insights-container">
                    <div class="card insight-card">
                        <h3>AI-Powered Insights</h3>
                        <div id="aiInsights" class="insights-list">
                            <div class="insight">
                                <span class="insight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg></span>
                                <div class="insight-content">
                                    <strong>Smart Analysis</strong>
                                    <p>Add more transactions to unlock AI insights about your spending patterns!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Spending Predictions</h3>
                        <div id="predictions" class="predictions-container">
                            <p class="empty-state">Predictions will appear after collecting enough data...</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Budget Recommendations</h3>
                        <div id="budgetRecommendations" class="recommendations-list">
                            <p class="empty-state">Budget recommendations will be generated based on your spending habits.</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Anomaly Detection</h3>
                        <div id="anomalies" class="anomalies-list">
                            <p class="empty-state">No unusual spending detected.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Tab -->
            <section id="settings-tab" class="tab-content">
                <div class="settings-container">
                    <div class="card">
                        <h3>Monthly Budget</h3>
                        <form id="budgetForm" class="settings-form">
                            <div class="form-group">
                                <label for="monthlyBudget">Set Monthly Budget ($)</label>
                                <input type="number" id="monthlyBudget" step="0.01" min="0" placeholder="2000.00">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Budget</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Category Budgets</h3>
                        <div id="categoryBudgets" class="category-budgets">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <div class="card">
                        <h3>Data Management</h3>
                        <div class="data-actions">
                            <button id="exportData" class="btn btn-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg> Export Data (JSON)</button>
                            <button id="importData" class="btn btn-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg> Import Data</button>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                            <button id="clearData" class="btn btn-danger"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg> Clear All Data</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>About</h3>
                        <p>SnapLedger v1.0.0</p>
                        <p>AI-powered personal finance tracker</p>
                        <p class="small-text">All data is stored locally on your device. No data is sent to external servers.</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Toast Notifications -->
        <div id="toast" class="toast"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/idb@8.0.0/build/umd.js"></script>
    
    <script src="js/icons.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/db.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>

    <!-- Register Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                refreshing = true;
                window.location.reload();
            });

            navigator.serviceWorker.register('sw.js')
                .then(reg => {
                    console.log('Service Worker registered', reg);
                    // Force an update check so new versions activate quickly.
                    reg.update();

                    reg.addEventListener('updatefound', () => {
                        const installing = reg.installing;
                        if (!installing) return;

                        installing.addEventListener('statechange', () => {
                            if (installing.state === 'installed' && navigator.serviceWorker.controller && reg.waiting) {
                                reg.waiting.postMessage({ type: 'SKIP_WAITING' });
                            }
                        });
                    });
                })
                .catch(err => console.log('Service Worker registration failed', err));
        }
    </script>
</body>
</html>
